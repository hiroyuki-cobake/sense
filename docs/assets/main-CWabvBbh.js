(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();const $="sense_settings_v1",q="sense_owned_v1",m={owned:{hand:[],foot:[]},settings:{sound:"spatial",pulse:"normal",light:"off",hand:"none",foot:"none"},runtime:{lastInputAt:performance.now(),idleMs:0}};function H(){try{const e=localStorage.getItem($);e&&(m.settings={...m.settings,...JSON.parse(e)})}catch{}try{const e=localStorage.getItem(q);e&&(m.owned={...m.owned,...JSON.parse(e)})}catch{}}function J(){localStorage.setItem($,JSON.stringify(m.settings))}function Z(e,t){m.settings[e]=t,J()}function K(e,t){return(m.owned[e]||[]).includes(t)}function j(){m.runtime.lastInputAt=performance.now()}function Q(e=performance.now()){return Math.max(0,e-m.runtime.lastInputAt)}const N=[{id:"legal-1",label:"transactions",href:"legal/transactions.html",icon:"doc"},{id:"legal-2",label:"service",href:"legal/terms_of_service.html",icon:"link"},{id:"legal-3",label:"privacy",href:"legal/privacy_policy.html",icon:"shield"}];function R(e,t,o){return Math.max(t,Math.min(o,e))}function W(e){const t=window.innerWidth,o=window.innerHeight,s=o*.82,i=o*.94,n=40,g=(t-n*2)/e,l=[];for(let c=0;c<e;c++){const u=n+g*c+g*.5,y=s+Math.random()*(i-s);l.push({x:R(u,n,t-n),y:R(y,s,i)})}return l}function ee(e){return new URL(e,window.location.origin).toString()}function te(e){const t=document.getElementById("legalModal"),o=document.getElementById("legalFrame");o.src=ee(e),t.hidden=!1}function ne({dockEl:e}){if(!e)return;e.innerHTML="";const t=W(N.length);N.forEach((o,s)=>{const i=document.createElement("a");i.className="legal-item is-visible",i.href="#",i.innerHTML=`<span class="legal-label">${o.label}</span>`,i.style.left=`${t[s].x}px`,i.style.top=`${t[s].y}px`,i.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),te(o.href)}),e.appendChild(i)})}const k=6,D=14,F=9e3,X=22e3,B=8;function oe({gearEl:e}){if(!e)return;C(e);const t=()=>{e.style.transition="transform 120ms ease",C(e),setTimeout(()=>e.style.transition="",220),setTimeout(t,O(F,X))};setTimeout(t,O(F,X)),window.addEventListener("resize",()=>C(e),{passive:!0})}function C(e){const t=P(k,D),o=P(k,D),s=e.getBoundingClientRect(),i=window.innerWidth,n=window.innerHeight;let r=t,g=o;s.right+t>i-B&&(r=-Math.abs(t)),s.left+t<B&&(r=Math.abs(t)),s.bottom+o>n-B&&(g=-Math.abs(o)),s.top+o<B&&(g=Math.abs(o)),e.style.transform=`translate3d(${r}px, ${g}px, 0)`}function P(e,t){const o=O(e,t);return Math.random()<.5?-o:o}function O(e,t){return Math.floor(Math.random()*(t-e+1))+e}const ie=[{key:"sound",label:"sound field",options:["spatial","mono","none"]},{key:"light",label:"light",options:["off","low"]},{key:"pulse",label:"pulse",options:["low","normal","high"]},{key:"hand",label:"bring what you have (hand)",options:["none","stick","light","glove"]},{key:"foot",label:"bring what you have (foot)",options:["none","shoes","leather","heel","zori"]},{key:"__operation__",label:"operation",action:"open_operation"}];function U(){const e=document.getElementById("settingsOverlay"),t=document.getElementById("settingsList"),o=document.getElementById("settingsClose");t.innerHTML="";const s=[...ie].map(n=>({v:n,r:Math.random()})).sort((n,r)=>n.r-r.r).map(n=>n.v);for(const n of s){if(n.action==="open_operation"){const c=document.createElement("div");c.className="setting-item";const u=document.createElement("span");u.textContent=n.label;const y=document.createElement("button");y.className="setting-select",y.textContent="view",y.addEventListener("click",()=>{const f=document.getElementById("operationOverlay");f.hidden=!1}),c.appendChild(u),c.appendChild(y),t.appendChild(c);continue}const r=document.createElement("div");r.className="setting-item";const g=document.createElement("span");g.textContent=n.label;const l=document.createElement("select");l.className="setting-select";for(const c of n.options){const u=document.createElement("option");u.value=c,u.textContent=c,m.settings[n.key]===c&&(u.selected=!0),l.appendChild(u)}l.addEventListener("change",c=>{const u=c.target.value;if(n.key==="hand"&&u!=="none"&&!m.owned.hand.includes(u)){alert("You need to purchase this item before using it."),l.value=m.settings[n.key];return}if(n.key==="foot"&&u!=="none"&&!m.owned.foot.includes(u)){alert("You need to purchase this item before using it."),l.value=m.settings[n.key];return}Z(n.key,u),J()}),r.appendChild(g),r.appendChild(l),t.appendChild(r)}o.onclick=()=>{e.hidden=!0};const i=document.getElementById("operationOverlay");i&&i.addEventListener("pointerdown",()=>{i.hidden=!0}),e.addEventListener("pointerdown",n=>{n.target.closest(".settings-panel")||(e.hidden=!0)})}function se(){U();const e=document.getElementById("settingsOverlay");e.hidden=!1}function re(){const e=document.getElementById("settingsOverlay");e.hidden=!0}function ae({canvas:e,onAnyInput:t,onRoam:o,onStep:s,onHoldWalk:i,onTouch:n,onPinch:r,onTapSpot:g}){let l=0,c=0,u=0,y=!1,f=!1,w=0,T=!1,a=0;const v=()=>performance.now(),d=p=>{t==null||t();const E=p.touches?[...p.touches]:null;if(E&&E.length===2){T=!0,a=Y(E[0],E[1]);return}f=!0,w=_(p),y=!1,clearTimeout(u),u=window.setTimeout(()=>{y=!0,i==null||i(!0)},320)},b=p=>{if(p.touches&&p.touches.length===2){t==null||t(),T=!0;const A=Y(p.touches[0],p.touches[1]),V=A-a;a=A,r==null||r(V);return}if(!f)return;t==null||t();const E=_(p),I=E-w;w=E,o==null||o(I)},M=p=>{if(T){(!p.touches||p.touches.length<2)&&(T=!1);return}if(f=!1,clearTimeout(u),y){y=!1,i==null||i(!1);return}const E=v();E-l<320?c+=1:c=1,l=E;const I=_(p),A=ce(p);g==null||g(I,A),window.setTimeout(()=>{v()-l>280&&(c===2?s==null||s(1):c>=3?s==null||s(-1):n==null||n(),c=0)},300)};e.addEventListener("touchstart",d,{passive:!0}),e.addEventListener("touchmove",b,{passive:!0}),e.addEventListener("touchend",M,{passive:!0}),e.addEventListener("mousedown",d),window.addEventListener("mousemove",b),window.addEventListener("mouseup",M)}function _(e){return e.touches&&e.touches[0]?e.touches[0].clientX:e.clientX??0}function ce(e){return e.touches&&e.touches[0]?e.touches[0].clientY:e.clientY??0}function Y(e,t){const o=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(o*o+s*s)}function le(){const e={angle:0,rotateBy(t){e.angle+=t*.004}};return e}function ue(e){const t={spot:{x:e.clientWidth*.5,y:e.clientHeight*.55,r:0,a:0},lastTapAt:0,tapSpot(o,s,i,n){i==="low"&&n==="light"&&K("hand","light")&&(t.spot.x=o,t.spot.y=s,t.spot.r=110,t.spot.a=.22,t.lastTapAt=performance.now())},update(o,s){o-t.lastTapAt>1200&&(t.spot.a*=.92,t.spot.r*=.985);const n=Math.min(.06,s/4e4*.06);t._idleGlow=n},draw(o,s,i){if(t._idleGlow>0&&(o.fillStyle=`rgba(255,255,255,${t._idleGlow})`,o.fillRect(0,0,s,i)),t.spot.a<.01)return;const n=o.createRadialGradient(t.spot.x,t.spot.y,0,t.spot.x,t.spot.y,t.spot.r);n.addColorStop(0,`rgba(255,255,255,${t.spot.a})`),n.addColorStop(1,"rgba(255,255,255,0)"),o.fillStyle=n,o.fillRect(0,0,s,i)}};return t}function de(){const e=t=>{navigator.vibrate&&navigator.vibrate(t)};return{step(t){t==="low"?e(6):t==="normal"?e(10):t==="high"&&e(16)},touch(t){t==="low"?e(4):t==="normal"?e(8):t==="high"&&e(12)}}}const h=(()=>{let e=null,t=null,o=!1,s="spatial",i=null;function n(f="spatial"){if(o){r(f);return}e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain(),t.gain.value=.65,t.connect(e.destination),i=e.createPanner(),i.panningModel="HRTF",i.distanceModel="inverse",i.refDistance=1,i.maxDistance=12,i.rolloffFactor=1.1,i.coneInnerAngle=360,i.coneOuterAngle=0,i.coneOuterGain=0,r(f),o=!0}function r(f){s=f,t&&(s==="none"?t.gain.value=0:t.gain.value=.65)}function g(){return e?e.currentTime:0}function l(){const f=2*((e==null?void 0:e.sampleRate)||48e3),w=e.createBuffer(1,f,e.sampleRate),T=w.getChannelData(0);for(let v=0;v<f;v++)T[v]=(Math.random()*2-1)*.25;const a=e.createBufferSource();return a.buffer=w,a.loop=!0,a}function c(f=180){const w=e.createOscillator();return w.type="sine",w.frequency.value=f,w}function u(f,w,T,a){if(e)if(s==="mono")f.connect(t);else{const v=e.createGain();v.gain.value=1,f.connect(v);const d=e.createPanner();return d.panningModel="HRTF",d.distanceModel="inverse",d.refDistance=1,d.maxDistance=12,d.rolloffFactor=1.1,d.positionX.value=w,d.positionY.value=T,d.positionZ.value=a,v.connect(d),d.connect(t),{gain:v,panner:d}}}function y(f){if(!e)return;const w=Math.sin(f),T=-Math.cos(f),a=e.listener;a.forwardX?(a.forwardX.value=w,a.forwardY.value=0,a.forwardZ.value=T,a.upX.value=0,a.upY.value=1,a.upZ.value=0):a.setOrientation(w,0,T,0,1,0)}return{ensureStarted:n,setMode:r,now:g,createNoise:l,createSine:c,connectSpatial:u,setListenerAngle:y,get ac(){return e},get started(){return o},get mode(){return s},get master(){return t}}})(),x=(()=>{let e=null,t=null,o=null,s=null;function i(){h.ac&&(n(),e=h.createNoise(),t=h.ac.createGain(),t.gain.value=0,e.connect(t),t.connect(h.master),e.start(),o=h.createSine(145),s=h.ac.createGain(),s.gain.value=0,o.connect(s),s.connect(h.master),o.start())}function n(){try{e==null||e.stop()}catch{}try{o==null||o.stop()}catch{}e=null,t=null,o=null,s=null}function r(l){t&&t.gain.setTargetAtTime(l,h.now(),.08)}function g(l,c=null){s&&(c&&o&&o.frequency.setTargetAtTime(c,h.now(),.08),s.gain.setTargetAtTime(l,h.now(),.08))}return{boot:i,stop:n,setAmbience:r,setTone:g}})(),S=(()=>{let e=!1,t=!1,o=0,s=0;function i(){h.started&&(x.boot(),e=!0)}function n(){e&&(x.setAmbience(.015),x.setTone(0))}function r(a,v,d){if(!e)return;h.setMode(d),h.setListenerAngle(v);const b=Math.min(1,a/12e3),M=.02+b*.08;x.setAmbience(M);const p=(Math.sin(performance.now()/1e3*.6)+1)*.5,E=b*.035*(p>.92?1:0);if(x.setTone(E,150+Math.sin(performance.now()/1500)*8),t){const I=(Math.sin(performance.now()/140)+1)*.5;x.setTone(Math.max(E,.01+I*.01),140)}o*=.96}function g(a,v){if(!e)return;const d=h.ac;if(!d)return;const b=h.createNoise(),M=d.createGain(),p=d.currentTime,E=w(v);M.gain.setValueAtTime(0,p),M.gain.linearRampToValueAtTime(E,p+.01),M.gain.exponentialRampToValueAtTime(1e-4,p+.12),b.connect(M);const I=Math.sin((s+=.6)+o)*.6,A=-.8-(a<0?.15:0);h.connectSpatial(M,I,0,A),b.start(),setTimeout(()=>{try{b.stop()}catch{}},140),a<0&&x.setAmbience(.07)}function l(a){if(!e)return;const v=h.ac;if(!v)return;const d=h.createNoise(),b=v.createGain(),M=v.currentTime,p=T(a);b.gain.setValueAtTime(0,M),b.gain.linearRampToValueAtTime(p,M+.008),b.gain.exponentialRampToValueAtTime(1e-4,M+.06),d.connect(b),h.connectSpatial(b,.2,0,-.7),d.start(),setTimeout(()=>{try{d.stop()}catch{}},80)}function c(a){o+=a*.002,o=Math.max(-2,Math.min(2,o))}function u(){t=!0}function y(){t=!1}function f(a){e&&a==="low"&&x.setAmbience(.01)}function w(a){switch(a){case"heel":return .08;case"leather":return .06;case"shoes":return .045;case"zori":return .05;default:return .028}}function T(a){switch(a){case"glove":return .045;case"stick":return .06;case"light":return .03;default:return .03}}return{boot:i,update:r,step:g,touch:l,pinch:c,holdStart:u,holdEnd:y,onUserAction:n,lightTap:f}})();let G=null,L=null;function fe(){L=document.getElementById("senseCanvas"),G=L.getContext("2d",{alpha:!1});const e=()=>{const n=Math.min(2,window.devicePixelRatio||1);L.width=Math.floor(L.clientWidth*n),L.height=Math.floor(L.clientHeight*n),G.setTransform(n,0,0,n,0,0)};e(),window.addEventListener("resize",e,{passive:!0});const t=le(),o=ue(L),s=de();ae({canvas:L,onAnyInput:()=>{j(),S.onUserAction()},onRoam:n=>t.rotateBy(n),onStep:n=>{S.step(n,m.settings.foot),s.step(m.settings.pulse)},onHoldWalk:n=>{n?S.holdStart():S.holdEnd()},onTouch:()=>{S.touch(m.settings.hand),s.touch(m.settings.pulse)},onPinch:n=>{S.pinch(n)},onTapSpot:(n,r)=>{o.tapSpot(n,r,m.settings.light,m.settings.hand),S.lightTap(m.settings.light)}}),window.addEventListener("sense-unlock-audio",()=>{h.ensureStarted(m.settings.sound),S.boot()});const i=n=>{const r=Q(n);S.update(r,t.angle,m.settings.sound),o.update(n,r),me(G,L.clientWidth,L.clientHeight,r,t.angle,o),requestAnimationFrame(i)};requestAnimationFrame(i)}function me(e,t,o,s,i,n){const r=e.createRadialGradient(t*.5,o*.55,0,t*.5,o*.55,Math.max(t,o)*.7);r.addColorStop(0,"rgb(5,5,5)"),r.addColorStop(1,"rgb(0,0,0)"),e.fillStyle=r,e.fillRect(0,0,t,o);const g=.02+Math.min(.05,s/25e3*.05);e.fillStyle=`rgba(255,255,255,${g})`;for(let l=0;l<18;l++){const c=(Math.sin((i+l)*1.7)*.5+.5)*t,u=(Math.cos((i*.7+l)*1.3)*.5+.5)*o;e.fillRect(c,u,1,1)}n.draw(e,t,o)}function z(){const e=document.getElementById("billingOverlay");e.hidden=!0}function pe(){const e=document.getElementById("billingOverlay");document.getElementById("billingCancel").addEventListener("click",()=>z()),e.addEventListener("pointerdown",o=>{o.target.closest(".billing-panel")||z()})}function ge(){H(),ne({dockEl:document.getElementById("legalDock")}),oe({gearEl:document.getElementById("gearBtn")}),U(),re(),pe(),fe(),document.getElementById("gearBtn").addEventListener("click",()=>{se()});const e=()=>{document.removeEventListener("pointerdown",e,!0),document.removeEventListener("touchstart",e,!0),window.dispatchEvent(new Event("sense-unlock-audio"))};document.addEventListener("pointerdown",e,!0),document.addEventListener("touchstart",e,!0)}ge();
