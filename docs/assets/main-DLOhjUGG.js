(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();const $="sense_settings_v1",q="sense_owned_v1",m={owned:{hand:[],foot:[]},settings:{sound:"spatial",pulse:"normal",light:"off",hand:"none",foot:"none"},runtime:{lastInputAt:performance.now(),idleMs:0}};function H(){try{const t=localStorage.getItem($);t&&(m.settings={...m.settings,...JSON.parse(t)})}catch{}try{const t=localStorage.getItem(q);t&&(m.owned={...m.owned,...JSON.parse(t)})}catch{}}function J(){localStorage.setItem($,JSON.stringify(m.settings))}function Z(t,e){m.settings[t]=e,J()}function K(t,e){return(m.owned[t]||[]).includes(e)}function j(){m.runtime.lastInputAt=performance.now()}function Q(t=performance.now()){return Math.max(0,t-m.runtime.lastInputAt)}const N=[{id:"legal-1",label:"transactions",href:"legal/transactions.html",icon:"doc"},{id:"legal-2",label:"service",href:"legal/terms_of_service.html",icon:"link"},{id:"legal-3",label:"privacy",href:"legal/privacy_policy.html",icon:"shield"}];function R(t,e,o){return Math.max(e,Math.min(o,t))}function W(t,e){const o=t.getBoundingClientRect(),s=o.width,i=o.height,n=24,r=10,p=10,c=Math.max(1,s-n*2)/e,l=r,y=Math.max(l,i-p),u=[];for(let h=0;h<e;h++){const b=n+c*h+c*.5,a=l+Math.random()*(y-l);u.push({x:R(b,n,s-n),y:R(a,l,y)})}return u}function tt(t){return new URL(t,window.location.origin).toString()}function et(t){const e=document.getElementById("legalModal"),o=document.getElementById("legalFrame");!e||!o||(o.src=tt(t),e.hidden=!1)}function nt({dockEl:t}){if(!t)return;t.innerHTML="";const e=()=>{t.innerHTML="";const o=W(t,N.length);N.forEach((s,i)=>{const n=document.createElement("a");n.className="legal-item is-visible",n.href="#",n.innerHTML=`<span class="legal-label">${s.label}</span>`,n.style.left=`${o[i].x}px`,n.style.top=`${o[i].y}px`,n.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),et(s.href)}),t.appendChild(n)})};window.addEventListener("resize",e,{passive:!0}),e()}const k=6,D=14,X=9e3,F=22e3,A=8;function ot({gearEl:t}){if(!t)return;C(t);const e=()=>{t.style.transition="transform 120ms ease",C(t),setTimeout(()=>t.style.transition="",220),setTimeout(e,O(X,F))};setTimeout(e,O(X,F)),window.addEventListener("resize",()=>C(t),{passive:!0})}function C(t){const e=Y(k,D),o=Y(k,D),s=t.getBoundingClientRect(),i=window.innerWidth,n=window.innerHeight;let r=e,p=o;s.right+e>i-A&&(r=-Math.abs(e)),s.left+e<A&&(r=Math.abs(e)),s.bottom+o>n-A&&(p=-Math.abs(o)),s.top+o<A&&(p=Math.abs(o)),t.style.transform=`translate3d(${r}px, ${p}px, 0)`}function Y(t,e){const o=O(t,e);return Math.random()<.5?-o:o}function O(t,e){return Math.floor(Math.random()*(e-t+1))+t}const it=[{key:"sound",label:"sound field",options:["spatial","mono","none"]},{key:"light",label:"light",options:["off","low"]},{key:"pulse",label:"pulse",options:["low","normal","high"]},{key:"hand",label:"bring what you have (hand)",options:["none","stick","light","glove"]},{key:"foot",label:"bring what you have (foot)",options:["none","shoes","leather","heel","zori"]},{key:"__operation__",label:"operation",action:"open_operation"}];function U(){const t=document.getElementById("settingsOverlay"),e=document.getElementById("settingsList"),o=document.getElementById("settingsClose");e.innerHTML="";const s=[...it].map(n=>({v:n,r:Math.random()})).sort((n,r)=>n.r-r.r).map(n=>n.v);for(const n of s){if(n.action==="open_operation"){const c=document.createElement("div");c.className="setting-item";const l=document.createElement("span");l.textContent=n.label;const y=document.createElement("button");y.className="setting-select",y.textContent="view",y.addEventListener("click",()=>{const u=document.getElementById("operationOverlay");u.hidden=!1}),c.appendChild(l),c.appendChild(y),e.appendChild(c);continue}const r=document.createElement("div");r.className="setting-item";const p=document.createElement("span");p.textContent=n.label;const d=document.createElement("select");d.className="setting-select";for(const c of n.options){const l=document.createElement("option");l.value=c,l.textContent=c,m.settings[n.key]===c&&(l.selected=!0),d.appendChild(l)}d.addEventListener("change",c=>{const l=c.target.value;if(n.key==="hand"&&l!=="none"&&!m.owned.hand.includes(l)){alert("You need to purchase this item before using it."),d.value=m.settings[n.key];return}if(n.key==="foot"&&l!=="none"&&!m.owned.foot.includes(l)){alert("You need to purchase this item before using it."),d.value=m.settings[n.key];return}Z(n.key,l),J()}),r.appendChild(p),r.appendChild(d),e.appendChild(r)}o.onclick=()=>{t.hidden=!0};const i=document.getElementById("operationOverlay");i&&i.addEventListener("pointerdown",()=>{i.hidden=!0}),t.addEventListener("pointerdown",n=>{n.target.closest(".settings-panel")||(t.hidden=!0)})}function st(){U();const t=document.getElementById("settingsOverlay");t.hidden=!1}function rt(){const t=document.getElementById("settingsOverlay");t.hidden=!0}function at({canvas:t,onAnyInput:e,onRoam:o,onStep:s,onHoldWalk:i,onTouch:n,onPinch:r,onTapSpot:p}){let d=0,c=0,l=0,y=!1,u=!1,h=0,b=!1,a=0;const w=()=>performance.now(),f=g=>{e==null||e();const E=g.touches?[...g.touches]:null;if(E&&E.length===2){b=!0,a=P(E[0],E[1]);return}u=!0,h=_(g),y=!1,clearTimeout(l),l=window.setTimeout(()=>{y=!0,i==null||i(!0)},320)},M=g=>{if(g.touches&&g.touches.length===2){e==null||e(),b=!0;const B=P(g.touches[0],g.touches[1]),V=B-a;a=B,r==null||r(V);return}if(!u)return;e==null||e();const E=_(g),I=E-h;h=E,o==null||o(I)},T=g=>{if(b){(!g.touches||g.touches.length<2)&&(b=!1);return}if(u=!1,clearTimeout(l),y){y=!1,i==null||i(!1);return}const E=w();E-d<320?c+=1:c=1,d=E;const I=_(g),B=ct(g);p==null||p(I,B),window.setTimeout(()=>{w()-d>280&&(c===2?s==null||s(1):c>=3?s==null||s(-1):n==null||n(),c=0)},300)};t.addEventListener("touchstart",f,{passive:!0}),t.addEventListener("touchmove",M,{passive:!0}),t.addEventListener("touchend",T,{passive:!0}),t.addEventListener("mousedown",f),window.addEventListener("mousemove",M),window.addEventListener("mouseup",T)}function _(t){return t.touches&&t.touches[0]?t.touches[0].clientX:t.clientX??0}function ct(t){return t.touches&&t.touches[0]?t.touches[0].clientY:t.clientY??0}function P(t,e){const o=t.clientX-e.clientX,s=t.clientY-e.clientY;return Math.sqrt(o*o+s*s)}function lt(){const t={angle:0,rotateBy(e){t.angle+=e*.004}};return t}function ut(t){const e={spot:{x:t.clientWidth*.5,y:t.clientHeight*.55,r:0,a:0},lastTapAt:0,tapSpot(o,s,i,n){i==="low"&&n==="light"&&K("hand","light")&&(e.spot.x=o,e.spot.y=s,e.spot.r=110,e.spot.a=.22,e.lastTapAt=performance.now())},update(o,s){o-e.lastTapAt>1200&&(e.spot.a*=.92,e.spot.r*=.985);const n=Math.min(.06,s/4e4*.06);e._idleGlow=n},draw(o,s,i){if(e._idleGlow>0&&(o.fillStyle=`rgba(255,255,255,${e._idleGlow})`,o.fillRect(0,0,s,i)),e.spot.a<.01)return;const n=o.createRadialGradient(e.spot.x,e.spot.y,0,e.spot.x,e.spot.y,e.spot.r);n.addColorStop(0,`rgba(255,255,255,${e.spot.a})`),n.addColorStop(1,"rgba(255,255,255,0)"),o.fillStyle=n,o.fillRect(0,0,s,i)}};return e}function dt(){const t=e=>{navigator.vibrate&&navigator.vibrate(e)};return{step(e){e==="low"?t(6):e==="normal"?t(10):e==="high"&&t(16)},touch(e){e==="low"?t(4):e==="normal"?t(8):e==="high"&&t(12)}}}const v=(()=>{let t=null,e=null,o=!1,s="spatial",i=null;function n(u="spatial"){if(o){r(u);return}t=new(window.AudioContext||window.webkitAudioContext),e=t.createGain(),e.gain.value=.65,e.connect(t.destination),i=t.createPanner(),i.panningModel="HRTF",i.distanceModel="inverse",i.refDistance=1,i.maxDistance=12,i.rolloffFactor=1.1,i.coneInnerAngle=360,i.coneOuterAngle=0,i.coneOuterGain=0,r(u),o=!0}function r(u){s=u,e&&(s==="none"?e.gain.value=0:e.gain.value=.65)}function p(){return t?t.currentTime:0}function d(){const u=2*((t==null?void 0:t.sampleRate)||48e3),h=t.createBuffer(1,u,t.sampleRate),b=h.getChannelData(0);for(let w=0;w<u;w++)b[w]=(Math.random()*2-1)*.25;const a=t.createBufferSource();return a.buffer=h,a.loop=!0,a}function c(u=180){const h=t.createOscillator();return h.type="sine",h.frequency.value=u,h}function l(u,h,b,a){if(t)if(s==="mono")u.connect(e);else{const w=t.createGain();w.gain.value=1,u.connect(w);const f=t.createPanner();return f.panningModel="HRTF",f.distanceModel="inverse",f.refDistance=1,f.maxDistance=12,f.rolloffFactor=1.1,f.positionX.value=h,f.positionY.value=b,f.positionZ.value=a,w.connect(f),f.connect(e),{gain:w,panner:f}}}function y(u){if(!t)return;const h=Math.sin(u),b=-Math.cos(u),a=t.listener;a.forwardX?(a.forwardX.value=h,a.forwardY.value=0,a.forwardZ.value=b,a.upX.value=0,a.upY.value=1,a.upZ.value=0):a.setOrientation(h,0,b,0,1,0)}return{ensureStarted:n,setMode:r,now:p,createNoise:d,createSine:c,connectSpatial:l,setListenerAngle:y,get ac(){return t},get started(){return o},get mode(){return s},get master(){return e}}})(),x=(()=>{let t=null,e=null,o=null,s=null;function i(){v.ac&&(n(),t=v.createNoise(),e=v.ac.createGain(),e.gain.value=0,t.connect(e),e.connect(v.master),t.start(),o=v.createSine(145),s=v.ac.createGain(),s.gain.value=0,o.connect(s),s.connect(v.master),o.start())}function n(){try{t==null||t.stop()}catch{}try{o==null||o.stop()}catch{}t=null,e=null,o=null,s=null}function r(d){e&&e.gain.setTargetAtTime(d,v.now(),.08)}function p(d,c=null){s&&(c&&o&&o.frequency.setTargetAtTime(c,v.now(),.08),s.gain.setTargetAtTime(d,v.now(),.08))}return{boot:i,stop:n,setAmbience:r,setTone:p}})(),S=(()=>{let t=!1,e=!1,o=0,s=0;function i(){v.started&&(x.boot(),t=!0)}function n(){t&&(x.setAmbience(.015),x.setTone(0))}function r(a,w,f){if(!t)return;v.setMode(f),v.setListenerAngle(w);const M=Math.min(1,a/12e3),T=.02+M*.08;x.setAmbience(T);const g=(Math.sin(performance.now()/1e3*.6)+1)*.5,E=M*.035*(g>.92?1:0);if(x.setTone(E,150+Math.sin(performance.now()/1500)*8),e){const I=(Math.sin(performance.now()/140)+1)*.5;x.setTone(Math.max(E,.01+I*.01),140)}o*=.96}function p(a,w){if(!t)return;const f=v.ac;if(!f)return;const M=v.createNoise(),T=f.createGain(),g=f.currentTime,E=h(w);T.gain.setValueAtTime(0,g),T.gain.linearRampToValueAtTime(E,g+.01),T.gain.exponentialRampToValueAtTime(1e-4,g+.12),M.connect(T);const I=Math.sin((s+=.6)+o)*.6,B=-.8-(a<0?.15:0);v.connectSpatial(T,I,0,B),M.start(),setTimeout(()=>{try{M.stop()}catch{}},140),a<0&&x.setAmbience(.07)}function d(a){if(!t)return;const w=v.ac;if(!w)return;const f=v.createNoise(),M=w.createGain(),T=w.currentTime,g=b(a);M.gain.setValueAtTime(0,T),M.gain.linearRampToValueAtTime(g,T+.008),M.gain.exponentialRampToValueAtTime(1e-4,T+.06),f.connect(M),v.connectSpatial(M,.2,0,-.7),f.start(),setTimeout(()=>{try{f.stop()}catch{}},80)}function c(a){o+=a*.002,o=Math.max(-2,Math.min(2,o))}function l(){e=!0}function y(){e=!1}function u(a){t&&a==="low"&&x.setAmbience(.01)}function h(a){switch(a){case"heel":return .08;case"leather":return .06;case"shoes":return .045;case"zori":return .05;default:return .028}}function b(a){switch(a){case"glove":return .045;case"stick":return .06;case"light":return .03;default:return .03}}return{boot:i,update:r,step:p,touch:d,pinch:c,holdStart:l,holdEnd:y,onUserAction:n,lightTap:u}})();let G=null,L=null;function ft(){L=document.getElementById("senseCanvas"),G=L.getContext("2d",{alpha:!1});const t=()=>{const n=Math.min(2,window.devicePixelRatio||1);L.width=Math.floor(L.clientWidth*n),L.height=Math.floor(L.clientHeight*n),G.setTransform(n,0,0,n,0,0)};t(),window.addEventListener("resize",t,{passive:!0});const e=lt(),o=ut(L),s=dt();at({canvas:L,onAnyInput:()=>{j(),S.onUserAction()},onRoam:n=>e.rotateBy(n),onStep:n=>{S.step(n,m.settings.foot),s.step(m.settings.pulse)},onHoldWalk:n=>{n?S.holdStart():S.holdEnd()},onTouch:()=>{S.touch(m.settings.hand),s.touch(m.settings.pulse)},onPinch:n=>{S.pinch(n)},onTapSpot:(n,r)=>{o.tapSpot(n,r,m.settings.light,m.settings.hand),S.lightTap(m.settings.light)}}),window.addEventListener("sense-unlock-audio",()=>{v.ensureStarted(m.settings.sound),S.boot()});const i=n=>{const r=Q(n);S.update(r,e.angle,m.settings.sound),o.update(n,r),mt(G,L.clientWidth,L.clientHeight,r,e.angle,o),requestAnimationFrame(i)};requestAnimationFrame(i)}function mt(t,e,o,s,i,n){const r=t.createRadialGradient(e*.5,o*.55,0,e*.5,o*.55,Math.max(e,o)*.7);r.addColorStop(0,"rgb(5,5,5)"),r.addColorStop(1,"rgb(0,0,0)"),t.fillStyle=r,t.fillRect(0,0,e,o);const p=.02+Math.min(.05,s/25e3*.05);t.fillStyle=`rgba(255,255,255,${p})`;for(let d=0;d<18;d++){const c=(Math.sin((i+d)*1.7)*.5+.5)*e,l=(Math.cos((i*.7+d)*1.3)*.5+.5)*o;t.fillRect(c,l,1,1)}n.draw(t,e,o)}function z(){const t=document.getElementById("billingOverlay");t.hidden=!0}function gt(){const t=document.getElementById("billingOverlay");document.getElementById("billingCancel").addEventListener("click",()=>z()),t.addEventListener("pointerdown",o=>{o.target.closest(".billing-panel")||z()})}function ht(){H(),nt({dockEl:document.getElementById("legalDock")}),ot({gearEl:document.getElementById("gearBtn")}),U(),rt(),gt(),ft(),document.getElementById("gearBtn").addEventListener("click",()=>{st()});const t=()=>{document.removeEventListener("pointerdown",t,!0),document.removeEventListener("touchstart",t,!0),window.dispatchEvent(new Event("sense-unlock-audio"))};document.addEventListener("pointerdown",t,!0),document.addEventListener("touchstart",t,!0)}ht();
